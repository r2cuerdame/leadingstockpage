<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>í•œêµ­ì¹´ë³¸ (017960) - ì¢…ëª© ë¶„ì„</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    
    <!-- ApexCharts -->
    <script src="https://cdn.jsdelivr.net/npm/apexcharts"></script>
    
    <style>
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        .chart-container {
            background: white;
            border-radius: 15px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: 0 3px 10px rgba(0,0,0,0.05);
        }
        
        .ai-score {
            font-size: 3rem;
            font-weight: bold;
            color: #667eea;
        }
    </style>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row">
            <!-- ì™¼ìª½ ì»¬ëŸ¼: ì°¨íŠ¸ ë° ê¸°ë³¸ ì •ë³´ -->
            <div class="col-lg-8">
                <!-- í†µí•© ì°¨íŠ¸ ì„¹ì…˜ -->
                <div class="card mb-4">
                    <div class="card-header bg-primary text-white">
                        <div class="d-flex justify-content-between align-items-center">
                            <h5 class="mb-0">
                                <button onclick="history.back()" class="btn btn-sm btn-outline-light me-2" title="ë’¤ë¡œ ê°€ê¸°">
                                    <i class="fas fa-arrow-left"></i>
                                </button>
                                <i class="fas fa-chart-line"></i> í•œêµ­ì¹´ë³¸ (017960) ì°¨íŠ¸
                            </h5>
                            <a href="https://finance.naver.com/item/main.nhn?code=017960" 
                               target="_blank" 
                               class="btn btn-light btn-sm">
                                <i class="fas fa-external-link-alt"></i> ë„¤ì´ë²„ ê¸ˆìœµ
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <!-- ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ -->
                        <div id="stockChart" style="height: 450px;">
                            <div class="chart-loading text-center p-4">
                                <div class="spinner-border text-primary" role="status">
                                    <span class="visually-hidden">ì°¨íŠ¸ ë¡œë”© ì¤‘...</span>
                                </div>
                                <div class="mt-2 text-muted">1ë…„ ì°¨íŠ¸ ë°ì´í„° ë¡œë”© ì¤‘...</div>
                            </div>
                        </div>
                        
                        <!-- ê±°ë˜ëŸ‰ ì°¨íŠ¸ -->
                        <div id="volumeChart" style="height: 150px; margin-top: 20px;">
                            <div class="chart-loading text-center p-2">
                                <small class="text-muted">ê±°ë˜ëŸ‰ ì°¨íŠ¸ ë¡œë”© ì¤‘...</small>
                            </div>
                        </div>
                        
                        <!-- ì°¨íŠ¸ ì»¨íŠ¸ë¡¤ ì•ˆë‚´ -->
                        <div class="mt-3">
                            <small class="text-muted">
                                <i class="fas fa-info-circle"></i>
                                ì°¨íŠ¸ ì¡°ì‘: ë§ˆìš°ìŠ¤ íœ (í™•ëŒ€/ì¶•ì†Œ), ë“œë˜ê·¸(ì´ë™), í•˜ë‹¨ ê±°ë˜ëŸ‰ ì°¨íŠ¸ë¡œ ê¸°ê°„ ì„ íƒ
                            </small>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- ì˜¤ë¥¸ìª½ ì»¬ëŸ¼: ë¶„ì„ ì •ë³´ -->
            <div class="col-lg-4">
                <!-- AI ë¶„ì„ ì ìˆ˜ -->
                <div class="card mb-4 border-primary">
                    <div class="card-header bg-primary text-white">
                        <h5 class="mb-0"><i class="fas fa-brain"></i> AI ë¶„ì„ ì ìˆ˜</h5>
                    </div>
                    <div class="card-body text-center">
                        <div class="ai-score">0.0</div>
                        <div class="text-muted">ì¢…í•© ì ìˆ˜</div>
                        <div class="mt-3">
                            <span class="badge bg-info fs-6">
                                ë“±ê¸‰: N/A
                            </span>
                        </div>
                    </div>
                </div>
                
                <!-- ê°€ê²© ì •ë³´ -->
                <div class="card mb-4">
                    <div class="card-header bg-success text-white">
                        <h5 class="mb-0"><i class="fas fa-won-sign"></i> ê°€ê²© ì •ë³´</h5>
                    </div>
                    <div class="card-body">
                        <div class="row">
                            <div class="col-6">
                                <strong>í˜„ì¬ê°€</strong><br>
                                <span class="text-primary fs-5">50,000ì›</span>
                            </div>
                            <div class="col-6">
                                <strong>ëª©í‘œê°€</strong><br>
                                <span class="text-success fs-5">62,500ì›</span>
                            </div>
                        </div>
                        <hr>
                        <div class="row">
                            <div class="col-6">
                                <strong>ì˜ˆìƒìˆ˜ìµë¥ </strong><br>
                                <span class="text-success">+25.0%</span>
                            </div>
                            <div class="col-6">
                                <strong>íˆ¬ìê¸°ê°„</strong><br>
                                <span class="text-info">30ì¼</span>
                            </div>
                        </div>
                    </div>
                </div>
                
                <!-- ë¶„ì„ ìš”ì•½ -->
                <div class="card mb-4">
                    <div class="card-header bg-info text-white">
                        <h5 class="mb-0"><i class="fas fa-lightbulb"></i> ë¶„ì„ ìš”ì•½</h5>
                    </div>
                    <div class="card-body">
                        <p class="card-text">
                            AI ë¶„ì„ê²°ê³¼ 0.0ì ì˜ ì¢…ëª©ìœ¼ë¡œ í‰ê°€ë©ë‹ˆë‹¤.
                        </p>
                    </div>
                </div>
                
                <!-- ê¸°ìˆ ì  ë¶„ì„ -->
                <div class="card mb-4">
                    <div class="card-header bg-warning text-dark">
                        <h5 class="mb-0"><i class="fas fa-chart-bar"></i> ê¸°ìˆ ì  ë¶„ì„</h5>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <strong>ì°¨íŠ¸ íŒ¨í„´:</strong><br>
                            <span class="text-primary">ìƒìŠ¹ ì‚¼ê°í˜•</span>
                        </div>
                        <div class="mb-3">
                            <strong>ê¸°ìˆ ì  ì‹ í˜¸:</strong><br>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-arrow-up text-success me-2"></i>RSI ê³¼ë§¤ë„ êµ¬ê°„</li><li><i class="fas fa-arrow-up text-success me-2"></i>ë³¼ë¦°ì € ë°´ë“œ í•˜ë‹¨ í„°ì¹˜</li>
                            </ul>
                        </div>
                        <div class="mb-3">
                            <strong>ê±°ë˜ëŸ‰ ë¶„ì„:</strong><br>
                            <span class="text-success">ê±°ë˜ëŸ‰ ì¦ê°€ ì¶”ì„¸</span>
                        </div>
                        <div class="mb-3">
                            <strong>ì£¼ìš” í˜¸ì¬:</strong><br>
                            <ul class="list-unstyled">
                                <li><i class="fas fa-plus-circle text-success me-2"></i>ì‹¤ì  ê°œì„  ê¸°ëŒ€</li><li><i class="fas fa-plus-circle text-success me-2"></i>ì‹ ì œí’ˆ ì¶œì‹œ</li>
                            </ul>
                        </div>
                        <div>
                            <strong>ë¦¬ìŠ¤í¬ ìš”ì¸:</strong><br>
                            <ul class="list-unstyled text-danger">
                                <li><i class="fas fa-exclamation-triangle text-warning me-2"></i>ì›ìì¬ ê°€ê²© ë³€ë™ì„±</li><li><i class="fas fa-exclamation-triangle text-warning me-2"></i>ê¸€ë¡œë²Œ ê²½ê¸° ë‘”í™”</li>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        
        // 1ë…„ ì°¨íŠ¸ ë°ì´í„° ìƒì„± (í˜„ì‹¤ì ì¸ ì‹œë®¬ë ˆì´ì…˜)
        const generateChartData = () => {
            const data = [];
            const volumeData = [];
            let basePrice = 50000;
            
            // 1ë…„ (252 ê±°ë˜ì¼) ë°ì´í„° ìƒì„±
            const totalDays = 252;
            
            // ì‹œì¥ ì‚¬ì´í´ ë° íŠ¸ë Œë“œ ì‹œë®¬ë ˆì´ì…˜
            const trends = [
                { period: 60, direction: 'up', volatility: 0.02 },     // ìƒìŠ¹ êµ¬ê°„
                { period: 80, direction: 'sideways', volatility: 0.015 }, // íš¡ë³´ êµ¬ê°„  
                { period: 70, direction: 'down', volatility: 0.025 },     // í•˜ë½ êµ¬ê°„
                { period: 42, direction: 'recovery', volatility: 0.03 }   // ë°˜ë“± êµ¬ê°„
            ];
            
            let currentTrendIndex = 0;
            let daysInCurrentTrend = 0;
            
            for (let i = totalDays - 1; i >= 0; i--) {
                const date = new Date();
                date.setDate(date.getDate() - i);
                
                // í˜„ì¬ íŠ¸ë Œë“œ ê°€ì ¸ì˜¤ê¸°
                const currentTrend = trends[currentTrendIndex];
                
                // íŠ¸ë Œë“œë³„ ê°€ê²© ë³€ë™ ê³„ì‚°
                let trendMultiplier = 0;
                switch(currentTrend.direction) {
                    case 'up':
                        trendMultiplier = 0.0005 + (Math.random() * 0.001);
                        break;
                    case 'down': 
                        trendMultiplier = -0.0008 - (Math.random() * 0.001);
                        break;
                    case 'recovery':
                        trendMultiplier = 0.0012 + (Math.random() * 0.002);
                        break;
                    default: // sideways
                        trendMultiplier = (Math.random() - 0.5) * 0.0002;
                }
                
                // ì¼ì¼ ë³€ë™ì„± (Â±2-3%)
                const dailyVariation = (Math.random() - 0.5) * currentTrend.volatility * 2;
                
                // ê°€ê²© ê³„ì‚°
                const open = basePrice * (1 + trendMultiplier + dailyVariation);
                const closeVariation = (Math.random() - 0.5) * 0.02; // Â±1% ì¶”ê°€ ë³€ë™
                const close = open * (1 + closeVariation);
                
                // ê³ ê°€/ì €ê°€ ê³„ì‚° (ë” í˜„ì‹¤ì )
                const high = Math.max(open, close) * (1 + Math.random() * 0.01);
                const low = Math.min(open, close) * (1 - Math.random() * 0.01);
                
                data.push({
                    x: date.getTime(),
                    y: [
                        Math.round(open),
                        Math.round(high),
                        Math.round(low),
                        Math.round(close)
                    ]
                });
                
                // ê±°ë˜ëŸ‰ ì‹œë®¬ë ˆì´ì…˜ (ê°€ê²© ë³€ë™ê³¼ ìƒê´€ê´€ê³„ + ìƒ‰ìƒ ì •ë³´)
                const baseVolume = 100000;
                const priceChangePercent = Math.abs((close - open) / open);
                const volumeMultiplier = 1 + (priceChangePercent * 3); // ê°€ê²© ë³€ë™ í´ìˆ˜ë¡ ê±°ë˜ëŸ‰ ì¦ê°€
                const randomVolume = 0.5 + Math.random() * 1.5;
                const volume = Math.round(baseVolume * volumeMultiplier * randomVolume);
                
                // ìƒìŠ¹/í•˜ë½ì— ë”°ë¥¸ ê±°ë˜ëŸ‰ ìƒ‰ìƒ ê²°ì •
                const isUp = close > open;
                const volumeColor = isUp ? '#EF5350' : '#2196F3';  // ìƒìŠ¹: ë¹¨ê°•, í•˜ë½: íŒŒë‘
                
                volumeData.push({
                    x: date.getTime(),
                    y: volume,
                    fillColor: volumeColor
                });
                
                basePrice = close;
                daysInCurrentTrend++;
                
                // íŠ¸ë Œë“œ ì „í™˜
                if (daysInCurrentTrend >= currentTrend.period && currentTrendIndex < trends.length - 1) {
                    currentTrendIndex++;
                    daysInCurrentTrend = 0;
                }
            }
            
            return { priceData: data, volumeData: volumeData };
        };
        
        const { priceData, volumeData } = generateChartData();
        
        // ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ (ìƒë‹¨) - 1ë…„ ì°¨íŠ¸
        const candlestickOptions = {
            series: [{
                name: 'í•œêµ­ì¹´ë³¸',
                data: priceData
            }],
            chart: {
                type: 'candlestick',
                height: 450,  // ë†’ì´ ì¦ê°€
                id: 'candlesticks',
                toolbar: {
                    show: true,
                    autoSelected: 'pan',
                    tools: {
                        download: true,
                        selection: true,
                        zoom: true,
                        zoomin: true,
                        zoomout: true,
                        pan: true,
                        reset: true
                    }
                },
                zoom: {
                    enabled: true,
                    type: 'x',
                    autoScaleYaxis: true
                }
            },
            title: {
                text: 'í•œêµ­ì¹´ë³¸ (017960) - 1ë…„ ì°¨íŠ¸',
                align: 'left',
                style: {
                    fontSize: '16px',
                    fontWeight: 'bold',
                    color: '#333'
                }
            },
            xaxis: {
                type: 'datetime',
                labels: {
                    show: false  // í•˜ë‹¨ ì°¨íŠ¸ì—ë§Œ xì¶• ë¼ë²¨ í‘œì‹œ
                },
                crosshairs: {
                    show: true
                }
            },
            yaxis: {
                title: {
                    text: 'ì£¼ê°€ (ì›)'
                },
                tooltip: {
                    enabled: true
                },
                labels: {
                    formatter: function(value) {
                        return value.toLocaleString() + 'ì›';
                    }
                }
            },
            plotOptions: {
                candlestick: {
                    colors: {
                        upward: '#EF5350',    // ìƒìŠ¹: ë¹¨ê°„ìƒ‰ (í•œêµ­ í‘œì¤€)
                        downward: '#2196F3'   // í•˜ë½: íŒŒë€ìƒ‰ (í•œêµ­ í‘œì¤€)
                    },
                    wick: {
                        useFillColor: true
                    }
                }
            },
            tooltip: {
                custom: function({ seriesIndex, dataPointIndex, w }) {
                    const data = w.globals.seriesCandleO[seriesIndex][dataPointIndex];
                    const open = data[0];
                    const high = data[1]; 
                    const low = data[2];
                    const close = data[3];
                    const date = new Date(w.globals.seriesX[seriesIndex][dataPointIndex]);
                    const changeAmount = close - open;
                    const changePercent = ((close - open) / open * 100).toFixed(2);
                    const changeColor = changeAmount >= 0 ? '#EF5350' : '#2196F3';
                    
                    return '<div class="apexcharts-tooltip-candlestick">' +
                        '<div>ë‚ ì§œ: ' + date.toLocaleDateString('ko-KR') + '</div>' +
                        '<div>ì‹œê°€: ' + open.toLocaleString() + 'ì›</div>' +
                        '<div>ê³ ê°€: ' + high.toLocaleString() + 'ì›</div>' +
                        '<div>ì €ê°€: ' + low.toLocaleString() + 'ì›</div>' +
                        '<div>ì¢…ê°€: ' + close.toLocaleString() + 'ì›</div>' +
                        '<div style="color:' + changeColor + '">ë³€ë™: ' + 
                        (changeAmount >= 0 ? '+' : '') + changeAmount.toLocaleString() + 'ì› (' + 
                        (changeAmount >= 0 ? '+' : '') + changePercent + '%)</div>' +
                        '</div>';
                }
            }
        };
        
        // ê±°ë˜ëŸ‰ ì°¨íŠ¸ (í•˜ë‹¨) - ê°œì„ ëœ ë™ê¸°í™” ë° ë™ì  ìƒ‰ìƒ
        const volumeOptions = {
            series: [{
                name: 'ê±°ë˜ëŸ‰',
                data: volumeData.map(item => item.y)  // yê°’ë§Œ ì¶”ì¶œ
            }],
            chart: {
                type: 'bar',
                height: 150,  // ë†’ì´ ì¦ê°€
                brush: {
                    enabled: true,
                    target: 'candlesticks'
                },
                selection: {
                    enabled: true,
                    xaxis: {
                        min: priceData[0].x,  // 1ë…„ ì „ë¶€í„° (ì „ì²´ ë°ì´í„°ì˜ ì‹œì‘ì )
                        max: priceData[priceData.length - 1].x  // í˜„ì¬ê¹Œì§€ (ì „ì²´ ë°ì´í„°ì˜ ëì )
                    }
                }
            },
            colors: volumeData.map(item => item.fillColor),  // ê° ë§‰ëŒ€ì˜ ìƒ‰ìƒ ë°°ì—´
            plotOptions: {
                bar: {
                    distributed: true,  // ê° ë§‰ëŒ€ë§ˆë‹¤ ë‹¤ë¥¸ ìƒ‰ìƒ ì ìš©
                    columnWidth: '80%'
                }
            },
            stroke: {
                width: 1
            },
            legend: {
                show: false  // ë²”ë¡€ ìˆ¨ê¹€ (ê° ë§‰ëŒ€ê°€ ë‹¤ë¥¸ ìƒ‰ìƒì´ë¯€ë¡œ)
            },
            xaxis: {
                type: 'datetime',
                categories: volumeData.map(item => item.x),  // xì¶• ì¹´í…Œê³ ë¦¬ ì„¤ì •
                axisBorder: {
                    offsetX: 13
                },
                labels: {
                    datetimeUTC: false,
                    format: 'MM/dd'
                }
            },
            yaxis: {
                title: {
                    text: 'ê±°ë˜ëŸ‰'
                },
                labels: {
                    show: true,
                    formatter: function(value) {
                        if (value >= 1000000) {
                            return (value / 1000000).toFixed(1) + 'M';
                        } else if (value >= 1000) {
                            return (value / 1000).toFixed(0) + 'K';
                        }
                        return value.toFixed(0);
                    }
                }
            },
            tooltip: {
                y: {
                    formatter: function(value) {
                        return value.toLocaleString() + 'ì£¼';
                    }
                },
                custom: function({ seriesIndex, dataPointIndex, w }) {
                    const volume = w.globals.series[seriesIndex][dataPointIndex];
                    const date = new Date(volumeData[dataPointIndex].x);
                    
                    // í•´ë‹¹ ë‚ ì§œì˜ ìº”ë“¤ ë°ì´í„° ì°¾ê¸°
                    const candleData = priceData[dataPointIndex];
                    if (candleData) {
                        const open = candleData.y[0];
                        const close = candleData.y[3];
                        const isUp = close > open;
                        const colorText = isUp ? 'ìƒìŠ¹' : 'í•˜ë½';
                        const colorStyle = isUp ? '#EF5350' : '#2196F3';
                        
                        return '<div class="apexcharts-tooltip-bar">' +
                            '<div>ë‚ ì§œ: ' + date.toLocaleDateString('ko-KR') + '</div>' +
                            '<div>ê±°ë˜ëŸ‰: ' + volume.toLocaleString() + 'ì£¼</div>' +
                            '<div style="color:' + colorStyle + '">êµ¬ë¶„: ' + colorText + ' ë´‰</div>' +
                            '</div>';
                    }
                    
                    return '<div class="apexcharts-tooltip-bar">' +
                        '<div>ë‚ ì§œ: ' + date.toLocaleDateString('ko-KR') + '</div>' +
                        '<div>ê±°ë˜ëŸ‰: ' + volume.toLocaleString() + 'ì£¼</div>' +
                        '</div>';
                }
            }
        };
        
        // ì°¨íŠ¸ ë Œë”ë§
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // ì°¨íŠ¸ ì¸ìŠ¤í„´ìŠ¤ ìƒì„±
                const candlestickChart = new ApexCharts(document.querySelector("#stockChart"), candlestickOptions);
                const volumeChart = new ApexCharts(document.querySelector("#volumeChart"), volumeOptions);
                
                // ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ ë¨¼ì € ë Œë”ë§
                candlestickChart.render().then(function() {
                    console.log('âœ… 1ë…„ ìº”ë“¤ìŠ¤í‹± ì°¨íŠ¸ ë Œë”ë§ ì™„ë£Œ (í•œêµ­ ìƒ‰ìƒ: ìƒìŠ¹=ë¹¨ê°•, í•˜ë½=íŒŒë‘)');
                    
                    // ê·¸ ë‹¤ìŒ ê±°ë˜ëŸ‰ ì°¨íŠ¸ ë Œë”ë§
                    return volumeChart.render();
                }).then(function() {
                    console.log('âœ… ê±°ë˜ëŸ‰ ì°¨íŠ¸ ë Œë”ë§ ì™„ë£Œ (ë™ì  ìƒ‰ìƒ ì ìš©)');
                    console.log('ğŸ”— ì°¨íŠ¸ ë™ê¸°í™” ì„¤ì • ì™„ë£Œ (ApexCharts brush ê¸°ëŠ¥)');
                    
                    // ì°¨íŠ¸ ë¡œë”© ì™„ë£Œ í‘œì‹œ
                    const loadingElements = document.querySelectorAll('.chart-loading');
                    loadingElements.forEach(el => el.style.display = 'none');
                    
                }).catch(function(error) {
                    console.error('âŒ ì°¨íŠ¸ ë Œë”ë§ ì˜¤ë¥˜:', error);
                    
                    // ì˜¤ë¥˜ ë°œìƒ ì‹œ ê¸°ë³¸ ì°¨íŠ¸ë¼ë„ í‘œì‹œ
                    const stockChartEl = document.querySelector("#stockChart");
                    const volumeChartEl = document.querySelector("#volumeChart");
                    
                    if (stockChartEl) {
                        stockChartEl.innerHTML = '<div class="text-center p-4"><i class="fas fa-chart-line fa-3x text-muted"></i><br><span class="text-muted">ì°¨íŠ¸ ë°ì´í„° ë¡œë”© ì¤‘...</span></div>';
                    }
                    if (volumeChartEl) {
                        volumeChartEl.innerHTML = '<div class="text-center p-2"><span class="text-muted">ê±°ë˜ëŸ‰ ì°¨íŠ¸ ë¡œë”© ì¤‘...</span></div>';
                    }
                });
                
            } catch(error) {
                console.error('âŒ ì°¨íŠ¸ ì´ˆê¸°í™” ì˜¤ë¥˜:', error);
            }
        });
    </script>
</body>
</html>
